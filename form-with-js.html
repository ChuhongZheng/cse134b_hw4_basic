<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form</title>
    <style>
        /* Basic styling for better appearance */
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        fieldset {
            border: none;
            margin-bottom: 20px;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .submit-btn:hover, .submit-btn:focus {
            background-color: #45a049;
        }
        
        .required {
            color: red;
        }
        
        /* Error and info message styling */
        output {
            display: block;
            margin-top: 5px;
            padding: 8px;
            border-radius: 4px;
            min-height: 20px;
        }
        
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .info-message {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        
        /* Ensure hidden elements are not displayed */
        output[hidden] {
            display: none;
        }
        
        /* Validation styles */
        input:required:valid:not(:placeholder-shown),
        textarea:required:valid:not(:placeholder-shown) {
            border-color: #4CAF50;
            background-color: #f1f8e9;
        }
        
        input:required:invalid:not(:placeholder-shown),
        textarea:required:invalid:not(:placeholder-shown) {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        /* Specific validation styles for email */
        input[type="email"]:not(:placeholder-shown):invalid {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        /* Character counter styling */
        .char-counter {
            font-size: 14px;
            text-align: right;
            color: #666;
            margin-top: 5px;
        }
        
        .char-counter.warning {
            color: #ff9800;
        }
        
        .char-counter.error {
            color: #f44336;
        }
        
        /* Flash animation for invalid input */
        @keyframes flash {
            0% { background-color: #ffffff; }
            50% { background-color: #ffcdd2; }
            100% { background-color: #ffffff; }
        }
        
        .flash {
            animation: flash 0.3s ease-in-out;
        }
        
        /* Fade out animation for messages */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .fade-out {
            animation: fadeOut 1s forwards;
        }
        
        /* Style for required fields */
        input:required ~ label::after,
        textarea:required ~ label::after {
            content: " *";
            color: red;
        }
    </style>
</head>
<body>
    <h1>Contact Us</h1>
    <form action="https://httpbun.com/post" method="POST" id="contactForm">
        <!-- Hidden field for bot detection -->
        <input type="hidden" name="possible_bot" value="false" id="possibleBot">
        
        <!-- Hidden field for form errors -->
        <input type="hidden" name="form-errors" id="formErrors">
        
        <!-- Name field -->
        <fieldset>
            <label for="name">Name</label>
            <input 
                type="text" 
                id="name" 
                name="name" 
                required 
                minlength="2" 
                maxlength="50" 
                pattern="[A-Za-z\s]+" 
                placeholder="Enter your full name"
                title="Please enter a valid name (letters and spaces only, 2-50 characters)">
            <output class="error-message" for="name" hidden></output>
            <output class="info-message" for="name">Please enter your full name (letters and spaces only)</output>
        </fieldset>
        
        <!-- Email field -->
        <fieldset>
            <label for="email">Email</label>
            <input 
                type="email" 
                id="email" 
                name="email" 
                required 
                minlength="5" 
                maxlength="100" 
                placeholder="your.email@example.com"
                title="Please enter a valid email address">
            <output class="error-message" for="email" hidden></output>
            <output class="info-message" for="email">Please enter a valid email address</output>
        </fieldset>
        
        <!-- Phone field -->
        <fieldset>
            <label for="phone">Phone Number</label>
            <input 
                type="tel" 
                id="phone" 
                name="phone" 
                maxlength="20" 
                pattern="[\+]?[0-9\s\-\(\)]+" 
                placeholder="e.g., +1 (555) 123-4567"
                title="Please enter a valid phone number (numbers, spaces, hyphens, parentheses, and plus sign only)">
            <output class="error-message" for="phone" hidden></output>
            <output class="info-message" for="phone">Optional: Enter your phone number</output>
        </fieldset>
        
        <!-- Comments field (textarea) -->
        <fieldset>
            <label for="comments">Comments</label>
            <textarea 
                id="comments" 
                name="comments" 
                required 
                minlength="10" 
                maxlength="500" 
                placeholder="Enter your message here..."
                title="Please enter your comments (10-500 characters)"></textarea>
            <output class="error-message" for="comments" hidden></output>
            <output class="info-message" for="comments">Please provide detailed information (minimum 10 characters)</output>
            <div id="charCounter" class="char-counter">500 characters remaining</div>
        </fieldset>
        
        <!-- Submit button -->
        <button type="submit" class="submit-btn">Send Message</button>
    </form>

    <script>
        // Array to store form errors
        let form_errors = [];
        
        // DOM elements
        const form = document.getElementById('contactForm');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phone');
        const commentsInput = document.getElementById('comments');
        const charCounter = document.getElementById('charCounter');
        const possibleBot = document.getElementById('possibleBot');
        const formErrors = document.getElementById('formErrors');
        
        // Patterns for validation
        const namePattern = /^[A-Za-z\s]+$/;
        const phonePattern = /^[\+]?[0-9\s\-\(\)]+$/;
        
        // Add event listeners for input validation
        nameInput.addEventListener('input', handleNameInput);
        nameInput.addEventListener('blur', validateName);
        emailInput.addEventListener('blur', validateEmail);
        phoneInput.addEventListener('input', handlePhoneInput);
        phoneInput.addEventListener('blur', validatePhone);
        commentsInput.addEventListener('input', handleCommentsInput);
        form.addEventListener('submit', handleSubmit);
        
        // Handle name input with masking
        function handleNameInput(e) {
            const value = e.target.value;
            const lastChar = value.charAt(value.length - 1);
            
            // Check if the last entered character is valid
            if (lastChar && !namePattern.test(lastChar) && lastChar !== ' ') {
                flashField(nameInput);
                showError(nameInput, 'Illegal character detected. Only letters and spaces are allowed.');
                setTimeout(() => {
                    hideError(nameInput);
                }, 2000);
                
                // Remove the invalid character
                e.target.value = value.slice(0, -1);
                
                // Record the error
                recordError('name', value, 'Illegal character entered');
            }
        }
        
        // Validate name field
        function validateName() {
            const value = nameInput.value;
            
            if (!value) {
                showError(nameInput, 'Name is required.');
                return false;
            }
            
            if (value.length < 2) {
                showError(nameInput, 'Name must be at least 2 characters long.');
                return false;
            }
            
            if (value.length > 50) {
                showError(nameInput, 'Name must be no more than 50 characters long.');
                return false;
            }
            
            if (!namePattern.test(value)) {
                showError(nameInput, 'Name can only contain letters and spaces.');
                return false;
            }
            
            hideError(nameInput);
            return true;
        }
        
        // Validate email field
        function validateEmail() {
            const value = emailInput.value;
            
            if (!value) {
                showError(emailInput, 'Email is required.');
                return false;
            }
            
            if (value.length < 5) {
                showError(emailInput, 'Email must be at least 5 characters long.');
                return false;
            }
            
            if (value.length > 100) {
                showError(emailInput, 'Email must be no more than 100 characters long.');
                return false;
            }
            
            // Built-in email validation is sufficient
            if (!emailInput.checkValidity()) {
                showError(emailInput, 'Please enter a valid email address.');
                return false;
            }
            
            hideError(emailInput);
            return true;
        }
        
        // Handle phone input with masking
        function handlePhoneInput(e) {
            const value = e.target.value;
            const lastChar = value.charAt(value.length - 1);
            
            // Check if the last entered character is valid
            if (lastChar && !phonePattern.test(lastChar)) {
                flashField(phoneInput);
                showError(phoneInput, 'Illegal character detected. Only numbers, spaces, hyphens, parentheses, and plus sign are allowed.');
                setTimeout(() => {
                    hideError(phoneInput);
                }, 2000);
                
                // Remove the invalid character
                e.target.value = value.slice(0, -1);
                
                // Record the error
                recordError('phone', value, 'Illegal character entered');
            }
        }
        
        // Validate phone field
        function validatePhone() {
            const value = phoneInput.value;
            
            if (value && !phonePattern.test(value)) {
                showError(phoneInput, 'Please enter a valid phone number.');
                return false;
            }
            
            if (value.length > 20) {
                showError(phoneInput, 'Phone number must be no more than 20 characters long.');
                return false;
            }
            
            hideError(phoneInput);
            return true;
        }
        
        // Handle comments input with character counting
        function handleCommentsInput() {
            const value = commentsInput.value;
            const remaining = 500 - value.length;
            
            charCounter.textContent = `${remaining} characters remaining`;
            
            // Update styling based on remaining characters
            charCounter.classList.remove('warning', 'error');
            if (remaining < 50 && remaining >= 0) {
                charCounter.classList.add('warning');
            }
            
            if (remaining < 20 && remaining >= 0) {
                charCounter.classList.add('error');
            }
            
            // Prevent exceeding character limit
            if (value.length > 500) {
                commentsInput.value = value.substring(0, 500);
                charCounter.textContent = "0 characters remaining";
                charCounter.classList.add('error');
                flashField(commentsInput);
                showError(commentsInput, 'Character limit exceeded!');
                setTimeout(() => {
                    hideError(commentsInput);
                }, 2000);
                
                // Record the error
                recordError('comments', value, 'Character limit exceeded');
            }
            
            // Minimum length validation
            if (value.length > 0 && value.length < 10) {
                charCounter.classList.add('error');
            }
        }
        
        // Flash field to indicate error
        function flashField(field) {
            field.classList.add('flash');
            setTimeout(() => {
                field.classList.remove('flash');
            }, 300);
        }
        
        // Show error message
        function showError(field, message) {
            const errorOutput = field.parentNode.querySelector('.error-message');
            if (errorOutput) {
                errorOutput.textContent = message;
                errorOutput.hidden = false;
            }
        }
        
        // Hide error message
        function hideError(field) {
            const errorOutput = field.parentNode.querySelector('.error-message');
            if (errorOutput) {
                errorOutput.hidden = true;
            }
        }
        
        // Record form errors
        function recordError(fieldName, fieldValue, errorMessage) {
            const error = {
                field: fieldName,
                value: fieldValue,
                error: errorMessage,
                timestamp: new Date().toISOString()
            };
            
            form_errors.push(error);
        }
        
        // Handle form submission
        function handleSubmit(e) {
            // Validate all fields
            const isNameValid = validateName();
            const isEmailValid = validateEmail();
            const isPhoneValid = validatePhone();
            const isCommentsValid = commentsInput.value.length >= 10 && commentsInput.value.length <= 500;
            
            // Check if comments meet minimum length requirement
            if (commentsInput.value.length > 0 && commentsInput.value.length < 10) {
                showError(commentsInput, 'Comments must be at least 10 characters long.');
            } else if (commentsInput.value.length === 0) {
                showError(commentsInput, 'Comments are required.');
            } else {
                hideError(commentsInput);
            }
            
            // Record validation errors if any
            if (!isNameValid) recordError('name', nameInput.value, 'Invalid name');
            if (!isEmailValid) recordError('email', emailInput.value, 'Invalid email');
            if (!isPhoneValid) recordError('phone', phoneInput.value, 'Invalid phone');
            if (!isCommentsValid) recordError('comments', commentsInput.value, 'Invalid comments');
            
            // Store errors in hidden field as JSON
            formErrors.value = JSON.stringify(form_errors);
            
            // If any validation fails, prevent submission
            if (!isNameValid || !isEmailValid || !isPhoneValid || !isCommentsValid) {
                e.preventDefault();
                return false;
            }
        }
        
        // Initialize character counter
        charCounter.textContent = `${500 - commentsInput.value.length} characters remaining`;
        
        // Restore existing form errors from hidden field if available
        try {
            const existingErrors = JSON.parse(formErrors.value);
            if (Array.isArray(existingErrors)) {
                form_errors = existingErrors;
            }
        } catch (e) {
            // If parsing fails, start with empty array
            form_errors = [];
        }
    </script>
</body>
</html>